---
title: おいしいCookie、まずいCookie
tags:
  - '初心者'
  - 'Cookie'
  - 'アンチパターン'
private: false
updated_at: ''
id: null
organization_url_name: null
slide: false
ignorePublish: false
---
# はじめに

最近、[［改訂新版］プロになるためのWeb技術入門](https://gihyo.jp/book/2024/978-4-297-14571-2)を読みCookieの話が出てきたので、
どんな風に使っていくか、アンチパターンなどをまとめてみました。

## Cookieとは 🍪

簡単にCookieって何？どんなことができるの？などを説明します。

> Cookie（ウェブ Cookie、ブラウザー Cookie とも呼ぶ）は、サーバーがユーザーのウェブブラウザーに送信する小さなデータです。ブラウザーは Cookie を保存したり、新しい Cookie を作成したり、既存の Cookie を変更したり、後でリクエストされたときに同じサーバーにそれらを送り返したりすることができます。 Cookie により、ウェブアプリケーションは限られた量のデータを格納し、状態についての情報を記憶することができます。HTTP プロトコルは既定ではステートレスだからです。
>
> https://developer.mozilla.org/ja/docs/Web/HTTP/Guides/Cookies


細かく書かれていますが、  
要は、**Cookieは「ブラウザに保存される小さなメモ**です。

サーバーが「次回また来たときに、誰か分かるように」ブラウザに渡す識別情報を持っています。

### Cookieがないとどうなる？

前提としてクライアント（ブラウザ）とサーバーとのやりとりはHTTP通信で行われています。  
ただ、HTTP通信は1回の通信毎に完結する設計になっています。（ステートレス）

ということは、サーバーは通信した記憶をすぐに忘れてしまい、  
次のリクエストを投げてもさっきと同じユーザーだということがわかりません。

これは何が不便なのでしょうか？？

Chromeなどのブラウザを使ってECサイトを利用するケースで考えてみます。

あなたは、ある商品Aをカートに入れました。  
次に商品Bのページを見に行くとカートの中の商品Aが無くなっています。。。

あなた（ユーザー）の情報を保持できずに、一回きりの通信しか対応できません。

他にもそもそもログイン情報を保持できないので、  
毎回IDとパスワードを入力する手間や、ユーザーの設定も毎回リセットされます。

現代の複雑なWebアプリケーションで情報が保持できないのは致命傷ですよね、、、

### ステートフルを実現する

このような課題を解決するのがCookieです。

一回きりのHTTP通信でも、ユーザーとのやり取り（セッション）やユーザーを一意に特定できれば情報を保持し継続性を持たせることができます。

Cookieの中に、ユーザーやセッションを特定するIDを持たせることで実現しています。

「ならCookieの中に全てカート内の情報などを持たせたらどうなの？」という疑問もあると思います。

Cookieは大量な情報を持っておくことを目的としていない、改ざんによるセキュリティリスクなどがあるので避けた方が良いです。

基本的な情報処理はサーバー側にさせた方が良いので、  
Cookieはユーザーやセッションを特定するタグ（ラベル）を持っているというイメージです。

セッションIDやユーザーIDなどが流出すると、  
それらのやりとりが乗っ取られるのでCookieの扱いは注意が必要です。

そのあたり”まずいCookie”パートで説明していきます。


# おいしいCookie

このパートでは、抑えておきたいCookieの設定のポイントを整理していきます。

